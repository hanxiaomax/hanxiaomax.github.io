---
layout: post
title: "Makefile 101 for dummies just like me"
category: cpp
tags: [C/C++,linux,makefile,header file,gcc]
modified: 2014-02-21
image:
  feature: article.jpg
comments: true
share: true
---

目录

* Table of Contents
{:toc}


##编译过程和多文件组织
###1.头文件
尖括号`<>`：搜索其他路径，而不搜索当前目录。  
   对于UNIX双引号`""`优先搜索本地目录
###2.作用域和链接

###3.编译过程
预编译(Preprocessing)--->编译(Compilation)--->汇编 (Assembly)--->连接(Linking)
每一个步骤生成不同的文件。

如图[^1]
<figure>
    <a href="/images/makefile-1-1.jpg"> <!--herf是超链接-->
        <img src="/images/makefile-1-1.jpg"><!--img标签必须有src属性=“图片位置”-->
    </a>
</figure>

###4.Gcc

上述编译过程，gcc提供一步到位的命令`gcc test.c -o test`
也可以分开进行





>If you only want some of the stages of compilation, you can
use -x (or filename suffixes) to tell gcc where to start

`-c`  Compile or assemble the source files, but do not link.生成object file `.o`文件  

`-o` file
           Place output in file file.  This applies regardless to
           whatever sort of output is being produced, whether it be
           an executable file, an object file, an assembler file or
           preprocessed C code.  

使用`$ man gcc`查看全部gcc手册

##初步编写makefile

###1.可以使用makefile或者Makefile，最好使用后者  

###2.makefile的规则

    target ... : prerequisites ...
	     command

`target`：准备生成的目标文件，可以是最终的可执行文件或者是中间文件。  

`prerequisites`： 生成不同类型target，需要依赖的文件    
1.生成`可执行文件`需要依赖的`.o`结尾的`中间文件`(`main.o`,`source1.o`,`source2.o`...)  
2.生成`中间文件`，需要`.c`结尾的`源文件`和`.h`结尾的`头文件`(`source1.o`需要`source1.c`,`source1.h`...)    

`command`：make需要执行的命令。比如gcc

对于一个完整的makefile，需要重复多次该代码块，生成全部的中间文件，再用中间文件生成最后的可执行文件。


`clean`并不会在运行make时自动使用（[伪目标](http://wiki.ubuntu.org.cn/%E8%B7%9F%E6%88%91%E4%B8%80%E8%B5%B7%E5%86%99Makefile:%E4%B9%A6%E5%86%99%E8%A7%84%E5%88%99#.E4.BC.AA.E7.9B.AE.E6.A0.87)），所以如果只是make的话，会生成很多中间文件。可以主动使用`make clean`则运行clean后面的命令，清除需要清除的文件，多数是`.o`文件。
如果我们想要清除所有的`.o`文件，可以使用`*.o`命令，`*`是一种[通配符](http://wiki.ubuntu.org.cn/%E8%B7%9F%E6%88%91%E4%B8%80%E8%B5%B7%E5%86%99Makefile:%E4%B9%A6%E5%86%99%E8%A7%84%E5%88%99#.E5.9C.A8.E8.A7.84.E5.88.99.E4.B8.AD.E4.BD.BF.E7.94.A8.E9.80.9A.E9.85.8D.E7.AC.A6)。


###3.一个例子
    ex : ex12-2.o ex12-pe12.o  
	    cc -o ex ex12-2.o ex12-pe12.o
    ex12-2.o : ex12-2.c ex12-pe12.h
	    cc -c ex12-2.c
    ex12-pe12.o : ex12-pe12.c ex12-pe12.h
    	cc -c ex12-pe12.c
	clean :
	    rm edit ex12-2.o ex12-pe12.o
	    
   



[^1]:[C语言编译过程总结详解](http://tech.c114.net/175/a472966-2.html)

[和我一起写makefile](http://wiki.ubuntu.org.cn/%E8%B7%9F%E6%88%91%E4%B8%80%E8%B5%B7%E5%86%99Makefile)

[C++文档：Name visibility](http://www.cplusplus.com/doc/tutorial/namespaces/)

http://www.cnblogs.com/ggjucheng/archive/2011/12/14/2287738.html
